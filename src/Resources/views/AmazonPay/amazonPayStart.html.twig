<script>
    function getURLParameter(name, source) {
        return decodeURIComponent((new RegExp('[?|&|#]' + name + '=' +
            '([^&]+?)(&|#|;|$)').exec(source) || [,""])[1].replace(/\+/g,
            '%20')) || null
        ;
    }

    let accessToken = getURLParameter("access_token", location.hash);

    if (typeof accessToken === 'string' && accessToken.match(/^Atza/)) {
        document.cookie = "amazon_Login_accessToken=" + accessToken;
    }

    fetch('{{ path('bitbag_sylius_amazon_pay_initialize') }}', {
        method: 'POST',
        accessToken: accessToken
    }).then(function (data) {
        window.location.replace("{{ path('sylius_shop_checkout_address') }}" + location.hash);
    }).catch(function (data) {
        {#window.location.replace("{{ path('sylius_shop_cart_summary') }}");#}
    });
</script>
